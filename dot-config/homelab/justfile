# List available commands
default:
    @just --list

# Install mkcert, generate certificates, and create Traefik TLS config
setup:
    @echo "ðŸ”’ Setting up HTTPS certificates..."
    mkcert -install
    mkdir -p ./certs
    # Generate one cert for all your subdomains
    mkcert -key-file ./certs/local-key.pem -cert-file ./certs/local-cert.pem "localhost" "*.localhost" "n8n.localhost" "chat.localhost" "ollama.localhost" "search.localhost"
    # Create the dynamic Traefik config file automatically
    @echo "tls:\n  stores:\n    default:\n      defaultCertificate:\n        certFile: /certs/local-cert.pem\n        keyFile: /certs/local-key.pem" > ./certs/dynamic.yml
    @echo "âœ… Setup complete. Certificates and config generated."

# Run the stack (runs setup first automatically)
up: setup
    docker-compose up -d
    @echo "ðŸš€ Stack is running!"
    @echo "   - Traefik: https://localhost:8080"
    @echo "   - n8n:     https://n8n.localhost"
    @echo "   - Chat:    https://chat.localhost"
    @echo "   - Search:  https://search.localhost"

# Stop the stack
down:
    docker-compose down

# Stop the stack and remove volumes (Warning: Deletes data)
clean:
    docker-compose down -v
    rm -rf ./certs
